"use strict";function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return c=e.done,e},e:function(e){r=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(r)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}jQuery(function(e){var t,n;e(document.body).on("updated_shipping_method",function(){p()}).on("updated_wc_div",function(){p()}).on("updated_checkout",function(){p()});var i,a=wp.i18n,o=a.__,c=(a._x,a._n,a._nx,[]),r="",s="";function p(){var t=document.getElementsByClassName("wms_pickup_open_modal_google_maps");if(0!==t.length){var n,a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){n.value.addEventListener("click",function(){e(this).WCBackboneModal({template:this.getAttribute("wms-pickup-modal-id")}),r=document.getElementById(this.getAttribute("wms-pickup-modal-id")),i=r.querySelector(".wc-backbone-modal-loader"),u()})}}catch(e){a.e(e)}finally{a.f()}}}function u(){var e={zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,center:{lat:48.866667,lng:2.333333},disableDefaultUI:!0};s=new google.maps.Map(r.querySelector("#wms_pickup_modal_map_googlemaps"),e);var t="Paris",n=document.getElementById("billing_city"),i=document.getElementById("shipping_city");""!==n.value&&(t=n.value),""!==i.value&&(t=i.value),r.querySelector(".wms_pickup_modal_address_city_input").value=t;var a="75000",o=document.getElementById("billing_postcode"),p=document.getElementById("shipping_postcode");""!==o.value&&(a=o.value),""!==p.value&&(a=p.value),r.querySelector(".wms_pickup_modal_address_zipcode_input").value=a;var u="FR",d=document.getElementById("billing_country"),_=document.getElementById("shipping_country");""!==d.value&&(u=d.value),""!==_.value&&(u=_.value),r.querySelector(".wms_pickup_modal_address_country_select select").value=u,l(),r.querySelector(".wms_pickup_modal_address_search").addEventListener("click",function(){c.map(function(e){e.setMap(null)}),c=[],l()})}function l(){var a=function(){var e=r.querySelector(".wms_pickup_modal_address_country_select select").value;return""===e&&(e="FR"),{country:e,zipcode:r.querySelector(".wms_pickup_modal_address_zipcode_input").value,city:r.querySelector(".wms_pickup_modal_address_city_input").value}}(),p=a.country,u=a.zipcode,l=a.city;if(""===u||""===l)return alert(o("Please set a valid address","wc-multishipping")),!1;i.style.display="block";var m=e("#wms_nonce").val(),y={action:"wms_get_pickup_point",shipping_provider:e("#wms_shipping_provider").val(),country:p,zipcode:u,city:l,wms_nonce:m};return e.get(ajaxurl,y).then(function(e){if(i.style.display="none",e.error)return a=e.error_message,r.querySelector(".wms_pickup_modal_listing").innerHTML='<div style="color: #ff0000">'.concat(a,"</div>"),!1;var a,p,u=new google.maps.LatLngBounds;(n=r.querySelector(".wms_pickup_modal_listing")).innerHTML="",e.data.map(function(e){p={lat:parseFloat(e.latitude),lng:parseFloat(e.longitude)};var i,a,r=new google.maps.Marker({position:p,map:s,title:e.name,visible:!0,icon:"https://maps.google.com/mapfiles/ms/icons/red-dot.png"}),l=function(e){var t={0:o("Monday","wc-multishippping"),1:o("Tuesday","wc-multishippping"),2:o("Wednesday","wc-multishippping"),3:o("Thursday","wc-multishippping"),4:o("Friday","wc-multishippping"),5:o("Saturday","wc-multishippping"),6:o("Sunday","wc-multishippping")},i='<table class="wms_pickup_open_time">\n                                <tbody>';e.opening_time.map(function(e,n){i+="<tr><td>".concat(t[n],"</td><td> ").concat(e,"</td></tr>")}),i+="</tbody></table>";var a='<div class="wms_pickup_modal_listing_one" data-pickup-name="'.concat(e.name,'">\n                            <div class="wms_pickup_name" data-pickup-name="').concat(e.nom,'">').concat(e.name,'</div>\n                            <div class="wms_pickup_address1" data-pickup-address1="').concat(e.address,'">').concat(e.address,'</div>\n                            <div>\n                                <span class="wms_pickup_zipcode" data-pickup-zipcode="').concat(e.zip_code,'">').concat(e.zip_code,'</span>\n                                <span class="wms_pickup_city" data-pickup-city="').concat(e.city,'">').concat(e.city,'</span>\n                            </div>\n                            <div class="wms_pickup_country" data-pickup-country="').concat(e.country,'">').concat(e.country,"</div> \n                            ").concat(i,'\n                            <button class="button wms_pickup_modal_listing_one_button_ship" data-pickup-id="').concat(e.id,'">\n                                ').concat(o("Ship here","wc-multishipping"),"\n                            </button>\n                        </div>");return n.innerHTML+=a,new google.maps.InfoWindow({content:a.replace("wms_pickup_modal_listing_one_button_ship","wms_pickup_modal_infowindow_one_button_ship")})}(e);a=l,(i=r).addListener("click",function(){t&&t.close(),a.open(s,i),t=a,d(),google.maps.event.addListener(t,"domready",function(){var e=document.getElementsByClassName("wms_pickup_modal_infowindow_one_button_ship");null!=e&&_(e)});var e=document.querySelector('[data-pickup-name="'.concat(this.title,'"]'));e.scrollIntoView(),e.classList.add("wms_is_selected")}),c.push(r),u.extend(p)}),s.fitBounds(u),function(){var e,t=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_listing_one"));try{for(t.s();!(e=t.n()).done;){var n=e.value;n.addEventListener("click",function(){d(),this.classList.add("wms_is_selected")})}}catch(e){t.e(e)}finally{t.f()}}(),_();var l,m=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_listing_one_button_ship"));try{for(m.s();!(l=m.n()).done;)l.value}catch(e){m.e(e)}finally{m.f()}})}function d(){var e,t=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_listing_one"));try{for(t.s();!(e=t.n()).done;){e.value.classList.remove("wms_is_selected")}}catch(e){t.e(e)}finally{t.f()}}function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==t&&(t=document.getElementsByClassName("wms_pickup_modal_listing_one_button_ship"));var n,i=_createForOfIteratorHelper(t);try{for(i.s();!(n=i.n()).done;){n.value.addEventListener("click",function(){var t=document.querySelector('[id="wms_pickup_point"]');t.value=this.getAttribute("data-pickup-id");var n=new Event("change");t.dispatchEvent(n);var i=this.closest(".wms_pickup_modal_listing_one"),a=i.getAttribute("data-pickup-name"),c=this.getAttribute("data-pickup-id"),s=i.querySelector(".wms_pickup_address1").getAttribute("data-pickup-address1"),p=i.querySelector(".wms_pickup_zipcode").getAttribute("data-pickup-zipcode"),u=i.querySelector(".wms_pickup_city").getAttribute("data-pickup-city"),l=i.querySelector(".wms_pickup_country").getAttribute("data-pickup-country"),d=[a,s,u+" "+p,l],_=e("#wms_ajax_error"),m=e("#wms_pickup_selected"),y=e("#wms_nonce").val();confirm(sprintf(o("Please confirm you would like to ship here: %s","wc-multishipping"),"\n\n"+d.join("\n")))&&e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wms_select_pickup_point",pickup_id:c,pickup_name:a,pickup_address:s,pickup_zipcode:p,pickup_city:u,pickup_country:l,wms_nonce:y},beforeSend:function(){_.hide()},success:function(t){!1===t.error?(m.html("<div>"+d.join("</div><div>")+"</div>"),e("#wms_pickup_info").innerText=JSON.stringify(d),r.querySelector(".modal-close").click(),e("body").trigger("update_checkout")):(_.html(t.error_message),_.show())}})})}}catch(e){i.e(e)}finally{i.f()}}});