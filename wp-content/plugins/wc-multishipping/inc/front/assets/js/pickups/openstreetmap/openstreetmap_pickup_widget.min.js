"use strict";function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}jQuery(function(e){var t;e(document.body).on("updated_shipping_method",function(){p()}).on("updated_wc_div",function(){p()}).on("updated_checkout",function(){p()});var n,i=wp.i18n,a=i.__,r=(i._x,i._n,i._nx,[]),o="",c=null;function p(){var t=document.getElementsByClassName("wms_pickup_open_modal_openstreetmap");if(0!==t.length){var i,a=_createForOfIteratorHelper(t);try{for(a.s();!(i=a.n()).done;){i.value.addEventListener("click",function(){e(this).WCBackboneModal({template:this.getAttribute("wms-pickup-modal-id")}),o=document.getElementById(this.getAttribute("wms-pickup-modal-id")),n=o.querySelector(".wc-backbone-modal-loader"),u()})}}catch(e){a.e(e)}finally{a.f()}}}function u(){c=L.map("wms_pickup_modal_map_openstreemap").setView([48.866667,2.333333],14),L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:1,maxZoom:20}).addTo(c);var e="Paris",t=document.getElementById("billing_city"),n=document.getElementById("shipping_city");""!==t.value&&(e=t.value),""!==n.value&&(e=n.value),o.querySelector(".wms_pickup_modal_address_city_input").value=e;var i="75000",a=document.getElementById("billing_postcode"),p=document.getElementById("shipping_postcode");""!==a.value&&(i=a.value),""!==p.value&&(i=p.value),o.querySelector(".wms_pickup_modal_address_zipcode_input").value=i;var u="FR",l=document.getElementById("billing_country"),d=document.getElementById("shipping_country");""!==l.value&&(u=l.value),""!==d.value&&(u=d.value),o.querySelector(".wms_pickup_modal_address_country_select select").value=u,s(),o.querySelector(".wms_pickup_modal_address_search").addEventListener("click",function(){!function(){for(var e=0;e<r.length;e++)c.removeLayer(r[e])}(),s()})}function s(){var i=function(){var e=o.querySelector(".wms_pickup_modal_address_country_select select").value;return""===e&&(e="FR"),{country:e,zipcode:o.querySelector(".wms_pickup_modal_address_zipcode_input").value,city:o.querySelector(".wms_pickup_modal_address_city_input").value}}(),p=i.country,u=i.zipcode,s=i.city;if(""===u||""===s)return alert(a("Please set a valid address","wc-multishipping")),!1;n.style.display="block";var m=e("#wms_nonce").val(),y={action:"wms_get_pickup_point",shipping_provider:e("#wms_shipping_provider").val(),country:p,zipcode:u,city:s,wms_nonce:m};return n.style.display="none",e.get(ajaxurl,y).then(function(e){if(e.error)return n=e.error_message,o.querySelector(".wms_pickup_modal_listing").innerHTML='<div style="color: #ff0000">'.concat(n,"</div>"),!1;var n;(t=o.querySelector(".wms_pickup_modal_listing")).innerHTML="",e.data.map(function(n){e.data[0]==n&&c.setView([parseFloat(n.latitude),parseFloat(n.longitude)],13);var i=L.marker([parseFloat(n.latitude),parseFloat(n.longitude)],{title:n.name}).addTo(c),o=function(e){var n={0:a("Monday","wc-multishippping"),1:a("Tuesday","wc-multishippping"),2:a("Wednesday","wc-multishippping"),3:a("Thursday","wc-multishippping"),4:a("Friday","wc-multishippping"),5:a("Saturday","wc-multishippping"),6:a("Sunday","wc-multishippping")},i='<table class="wms_pickup_open_time">\n                                <tbody>';e.opening_time.map(function(e,t){i+="<tr><td>".concat(n[t],"</td><td> ").concat(e,"</td></tr>")}),i+="</tbody></table>";var r='<div class="wms_pickup_modal_listing_one" data-pickup-name="'.concat(e.name,'">\n                            <div class="wms_pickup_name" data-pickup-name="').concat(e.nom,'">').concat(e.name,'</div>\n                            <div class="wms_pickup_address1" data-pickup-address1="').concat(e.address,'">').concat(e.address,'</div>\n                            <div>\n                                <span class="wms_pickup_zipcode" data-pickup-zipcode="').concat(e.zip_code,'">').concat(e.zip_code,'</span>\n                                <span class="wms_pickup_city" data-pickup-city="').concat(e.city,'">').concat(e.city,'</span>\n                            </div>\n                            <div class="wms_pickup_country" data-pickup-country="').concat(e.country,'">').concat(e.country,"</div> \n                            ").concat(i,'\n                            <button class="button wms_pickup_modal_listing_one_button_ship" data-pickup-id="').concat(e.id,'">\n                                ').concat(a("Ship here","wc-multishipping"),"\n                            </button>\n                        </div>");return t.innerHTML+=r,r.replace("wms_pickup_modal_listing_one_button_ship","wms_pickup_modal_infowindow_one_button_ship")}(n);i.bindPopup("<b>"+n.name+"</b><br>"+o).on("click",d),r.push(i)}),function(){var e,t=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_listing_one"));try{for(t.s();!(e=t.n()).done;){var n=e.value;n.addEventListener("click",function(){l(),this.classList.add("wms_is_selected")})}}catch(e){t.e(e)}finally{t.f()}}(),_()})}function l(){var e,t=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_listing_one"));try{for(t.s();!(e=t.n()).done;){e.value.classList.remove("wms_is_selected")}}catch(e){t.e(e)}finally{t.f()}}function d(t){l();var n=document.querySelector('.wms_pickup_modal_listing [data-pickup-name="'.concat(t.target.options.title,'"]'));n.scrollIntoView(),n.classList.add("wms_is_selected");var i,a=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_infowindow_one_button_ship"));try{for(a.s();!(i=a.n()).done;){var r=i.value;_(e(r))}}catch(e){a.e(e)}finally{a.f()}}function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==t&&(t=document.getElementsByClassName("wms_pickup_modal_listing_one_button_ship"));var n,i=_createForOfIteratorHelper(t);try{for(i.s();!(n=i.n()).done;){n.value.addEventListener("click",function(){var t=document.querySelector('[id="wms_pickup_point"]');t.value=this.getAttribute("data-pickup-id");var n=new Event("change");t.dispatchEvent(n);var i=this.closest(".wms_pickup_modal_listing_one"),r=i.getAttribute("data-pickup-name"),c=this.getAttribute("data-pickup-id"),p=i.querySelector(".wms_pickup_address1").getAttribute("data-pickup-address1"),u=i.querySelector(".wms_pickup_zipcode").getAttribute("data-pickup-zipcode"),s=i.querySelector(".wms_pickup_city").getAttribute("data-pickup-city"),l=i.querySelector(".wms_pickup_country").getAttribute("data-pickup-country"),d=[r,p,s+" "+u,l],_=e("#wms_ajax_error"),m=e("#wms_pickup_selected"),y=e("#wms_nonce").val();confirm(sprintf(a("Please confirm you would like to ship here: %s","wc-multishipping"),"\n\n"+d.join("\n")))&&e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wms_select_pickup_point",pickup_id:c,pickup_name:r,pickup_address:p,pickup_zipcode:u,pickup_city:s,pickup_country:l,wms_nonce:y},beforeSend:function(){_.hide()},success:function(t){!1===t.error?(m.html("<div>"+d.join("</div><div>")+"</div>"),e("#wms_pickup_info").innerText=JSON.stringify(d),o.querySelector(".modal-close").click(),e("body").trigger("update_checkout")):(_.html(t.error_message),_.show())}})})}}catch(e){i.e(e)}finally{i.f()}}});