"use strict";function _createForOfIteratorHelper(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){c=!0,r=t},f:function(){try{o||null==i.return||i.return()}finally{if(c)throw r}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}jQuery(function(t){var e;p(),window.set_wms_openstreetmap_pickup_modal=p;var i,n=wp.i18n,a=n.__,r=(n._x,n._n,n._nx,[]),o="",c=null;function p(){var e=document.getElementsByClassName("wms_pickup_open_modal_openstreetmap");if(0!==e.length){var n,a=_createForOfIteratorHelper(e);try{for(a.s();!(n=a.n()).done;){n.value.addEventListener("click",function(){t(this).WCBackboneModal({template:this.getAttribute("wms-pickup-modal-id")}),o=document.getElementById(this.getAttribute("wms-pickup-modal-id")),i=o.querySelector(".wc-backbone-modal-loader"),t("#wms_shipping_provider").val(this.getAttribute("wms-shipping-provider")),s()})}}catch(t){a.e(t)}finally{a.f()}}}function s(){c=L.map("wms_pickup_modal_map_openstreemap").setView([48.866667,2.333333],14),L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:1,maxZoom:20}).addTo(c);o.querySelector(".wms_pickup_modal_address_city_input").value="Paris";o.querySelector(".wms_pickup_modal_address_zipcode_input").value="75000";o.querySelector(".wms_pickup_modal_address_country_select select").value="FR",u(),o.querySelector(".wms_pickup_modal_address_search").addEventListener("click",function(){!function(){for(var t=0;t<r.length;t++)c.removeLayer(r[t])}(),u()})}function u(){var n=function(){var t=o.querySelector(".wms_pickup_modal_address_country_select select").value;return""===t&&(t="FR"),{country:t,zipcode:o.querySelector(".wms_pickup_modal_address_zipcode_input").value,city:o.querySelector(".wms_pickup_modal_address_city_input").value}}(),p=n.country,s=n.zipcode,u=n.city;if(""===s||""===u)return alert(a("Please set a valid address","wc-multishipping")),!1;i.style.display="block";var m=t("#wms_nonce").val(),y={action:"wms_get_pickup_point",shipping_provider:t("#wms_shipping_provider").val(),country:p,zipcode:s,city:u,wms_nonce:m};return i.style.display="none",t.get(ajaxurl,y).then(function(t){if(t.error)return i=t.error_message,o.querySelector(".wms_pickup_modal_listing").innerHTML='<div style="color: #ff0000">'.concat(i,"</div>"),!1;var i;(e=o.querySelector(".wms_pickup_modal_listing")).innerHTML="",t.data.map(function(i){t.data[0]==i&&c.setView([parseFloat(i.latitude),parseFloat(i.longitude)],13);var n=L.marker([parseFloat(i.latitude),parseFloat(i.longitude)],{title:i.name}).addTo(c),o=function(t){var i={0:a("Monday","wc-multishippping"),1:a("Tuesday","wc-multishippping"),2:a("Wednesday","wc-multishippping"),3:a("Thursday","wc-multishippping"),4:a("Friday","wc-multishippping"),5:a("Saturday","wc-multishippping"),6:a("Sunday","wc-multishippping")},n='<table class="wms_pickup_open_time">\n                                <tbody>';t.opening_time.map(function(t,e){n+="<tr><td>".concat(i[e],"</td><td> ").concat(t,"</td></tr>")}),n+="</tbody></table>";var r='<div class="wms_pickup_modal_listing_one" data-pickup-name="'.concat(t.name,'">\n                            <div class="wms_pickup_name" data-pickup-name="').concat(t.nom,'">').concat(t.name,'</div>\n                            <div class="wms_pickup_address1" data-pickup-address1="').concat(t.address,'">').concat(t.address,'</div>\n                            <div>\n                                <span class="wms_pickup_zipcode" data-pickup-zipcode="').concat(t.zip_code,'">').concat(t.zip_code,'</span>\n                                <span class="wms_pickup_city" data-pickup-city="').concat(t.city,'">').concat(t.city,'</span>\n                            </div>\n                            <div class="wms_pickup_country" data-pickup-country="').concat(t.country,'">').concat(t.country,"</div> \n                            ").concat(n,'\n                            <button class="button wms_pickup_modal_listing_one_button_ship" data-pickup-id="').concat(t.id,'">\n                                ').concat(a("Ship here","wc-multishipping"),"\n                            </button>\n                        </div>");return e.innerHTML+=r,r.replace("wms_pickup_modal_listing_one_button_ship","wms_pickup_modal_infowindow_one_button_ship")}(i);n.bindPopup("<b>"+i.name+"</b><br>"+o).on("click",d),r.push(n)}),function(){var t,e=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_listing_one"));try{for(e.s();!(t=e.n()).done;){var i=t.value;i.addEventListener("click",function(){l(),this.classList.add("wms_is_selected")})}}catch(t){e.e(t)}finally{e.f()}}(),_()})}function l(){var t,e=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_listing_one"));try{for(e.s();!(t=e.n()).done;){t.value.classList.remove("wms_is_selected")}}catch(t){e.e(t)}finally{e.f()}}function d(e){l();var i=document.querySelector('.wms_pickup_modal_listing [data-pickup-name="'.concat(e.target.options.title,'"]'));i.scrollIntoView(),i.classList.add("wms_is_selected");var n,a=_createForOfIteratorHelper(document.getElementsByClassName("wms_pickup_modal_infowindow_one_button_ship"));try{for(a.s();!(n=a.n()).done;){var r=n.value;_(t(r))}}catch(t){a.e(t)}finally{a.f()}}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==e&&(e=document.getElementsByClassName("wms_pickup_modal_listing_one_button_ship"));var i,n=_createForOfIteratorHelper(e);try{for(n.s();!(i=n.n()).done;){i.value.addEventListener("click",function(){var e=document.querySelector('[id="wms_pickup_point"]');e.value=this.getAttribute("data-pickup-id");var i=new Event("change");e.dispatchEvent(i);var n=this.closest(".wms_pickup_modal_listing_one"),r=n.getAttribute("data-pickup-name"),c=(this.getAttribute("data-pickup-id"),n.querySelector(".wms_pickup_address1").getAttribute("data-pickup-address1")),p=n.querySelector(".wms_pickup_zipcode").getAttribute("data-pickup-zipcode"),s=n.querySelector(".wms_pickup_city").getAttribute("data-pickup-city"),u=n.querySelector(".wms_pickup_country").getAttribute("data-pickup-country"),l=[r,c,s+" "+p,u],d=t("#wms_pickup_selected");confirm(sprintf(a("Please confirm you would like to ship here: %s","wc-multishipping"),"\n\n"+l.join("\n")))&&(d.html("<strong>"+a("Your package will be shipped to:","wc-multishipping")+"</strong><div>"+l.join("</div><div>")+"</div>"),t("#wms_pickup_info").val(JSON.stringify({pickup_name:r,pickup_address:c,pickup_city:s,pickup_zipcode:p,pickup_country:u})),o.querySelector(".modal-close").click())})}}catch(t){n.e(t)}finally{n.f()}}});